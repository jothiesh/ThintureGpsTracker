# ============================================
# DEVELOPMENT ENVIRONMENT - MYSQL
# ============================================

# ============================================
# MYSQL DATABASE CONFIGURATION (Development)
# ============================================
spring.datasource.url=jdbc:mysql://thinturedb.c3oqsa2ui3r2.ap-south-1.rds.amazonaws.com:3306/ThintureGpsTrackerDB4?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8
spring.datasource.username=admin
spring.datasource.password=Thinture24
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.adjust-dates-to-context-time-zone=false
spring.datasource.hikari.connection-init-sql=SET time_zone='+00:00'

# JPA Configuration for Development
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.defer-datasource-initialization=true

# ðŸ”¥ FIX: Hibernate Naming Strategy (prevents column conflicts)
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl

# MySQL Connection Pool (Development)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.connection-test-query=SELECT 1

# ============================================
# MQTT CONFIGURATION (Development)
# ============================================
mqtt.broker-url=tcp://3.109.116.92:1883
mqtt.client-id=spring-client-dev
mqtt.connection.pool.size=1
mqtt.connection.pool.max-size=3

# ============================================
# LOGGING CONFIGURATION (Development)
# ============================================
logging.level.root=INFO
logging.level.com.GpsTracker.Thinture=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.mysql=INFO
logging.level.com.zaxxer.hikari=INFO

# MQTT logging (reduced to avoid spam)
logging.level.org.eclipse.paho.client.mqttv3=WARN
logging.level.org.springframework.integration.mqtt=INFO

# File logging
logging.file.name=logs/gps-tracker-dev.log
logging.pattern.console=%clr(%d{HH:mm:ss.SSS}){faint} %clr(%5p) %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx

# ============================================
# DEVELOPMENT SETTINGS
# ============================================
spring.thymeleaf.cache=false
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true

# Batch processing for development
batch.size=100
batch.flush.interval=2000

# ============================================
# ACTUATOR (Development)
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=always

# ============================================
# FLYWAY CONFIGURATION (DISABLED FOR DEV)
# ============================================
spring.flyway.enabled=false

# ============================================
# GPS DEVELOPMENT SETTINGS
# ============================================
gps.partition.auto-create=true
gps.partition.future-months=2
gps.partition.retention-months=6

# MySQL specific settings
spring.datasource.hikari.connection-init-sql=SET time_zone='+00:00'
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# Performance monitoring (relaxed for dev)
gps.performance.cpu-warning-threshold=80.0
gps.performance.memory-warning-threshold=80.0



# ============================================
# FIXED CONFIGURATION ISSUES
# ============================================

# ðŸ”¥ FIX 1: Add missing MQTT configuration
mqtt.enabled=true
mqtt.service.mode=pool
mqtt.connection.timeout=20
mqtt.connection.pool.max-inflight=500

# ðŸ”¥ FIX 2: Fix MySQL dialect deprecation warning
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
# Remove this deprecated line:
# spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# ðŸ”¥ FIX 3: Add missing health monitor configuration
mqtt.health.message-timeout-ms=300000
mqtt.health.min-connections=3
mqtt.health.max-failure-rate=10.0
mqtt.health.cpu-threshold=80.0
mqtt.health.memory-threshold=85.0
mqtt.health.device-timeout-ms=600000

# ðŸ”¥ FIX 4: Circuit breaker configuration
mqtt.health.circuit-breaker.failure-threshold=5
mqtt.health.circuit-breaker.timeout-ms=60000
mqtt.health.circuit-breaker.half-open-max-calls=3

# ðŸ”¥ FIX 5: Add AOP proxy configuration (critical!)
spring.aop.proxy-target-class=true

# ðŸ”¥ FIX 6: JVM timezone consistency
user.timezone=UTC
spring.jpa.properties.hibernate.jdbc.time_zone=UTC